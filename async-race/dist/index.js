!function(){"use strict";class t{constructor(t){this.element=document.createElement(t)}attachTo(e){return e instanceof t?e.element.append(this.element):e.append(this.element),this}setClass(t){const e=Array.isArray(t)?t:t.split(" ");return this.element.classList.add(...e),this}removeClass(t){const e=Array.isArray(t)?t:t.split(" ");return this.element.classList.remove(...e),this}setAttribute(t,e=""){return this.element.setAttribute(t,e),this}setInnerText(t){return this.element.innerText=t,this}setHandler(t,e,n){return this.element.addEventListener(t,e,n),this}setInnerHTML(t){return this.element.innerHTML=t,this}clearInnerHTML(){return this.element.innerHTML="",this}remove(){return this.element.remove(),this}animate(t,e){return this.element.animate(t,e)}}class e extends t{constructor(t,e){super("button"),this.setInnerText(t).setClass(["flex","justify-center","items-center","w-max","h-6","px-2","py-1","font-medium","text-gray-600","capitalize","border-2","border-transparent","rounded","transition-colors","cursor-pointer"]),"light"===e?this.setClass("bg-yellow-100 hover:border-indigo-400"):this.setClass("bg-indigo-200 hover:border-indigo-400"),this.status="enabled"}enable(){return this.removeClass("cursor-not-allowed opacity-50"),this.setClass("cursor-pointer hover:border-indigo-400 opacity-100"),this.status="enabled",this}disable(){return this.removeClass("cursor-pointer hover:border-indigo-400 opacity-100"),this.setClass("cursor-not-allowed opacity-50"),this.status="disabled",this}getStatus(){return this.status}}const n=["Acura","Alfa Romeo","Alpine","Apollo","Apple","Aston Martin","Audi","Automobili Pininfarina","Bentley","BMW","Bollinger","Brilliance","Bugatti","Buick","BYD","Cadillac","Chana","Chery","Chevrolet","Chrysler","Citroen","Continental","CUPRA","Dacia","Daewoo","Daihatsu","Datsun","Detroit Electric","Dodge","DS Automobiles","FAW","Ferrari","Fiat","Fisker","Ford","Foxtron","Geely","Genesis","GMC","Great Wall","Haval","Honda","Hummer","Hyundai","Ineos","Infiniti","Iran Khodro","JAC","Jaguar","Jeep","JETOUR","KIA","Koenigsegg","Lada","Lamborghini","Lancia","Land Rover","Lexus","Lifan","Lincoln","Lordstown","Lotus","Lucid","LvChi","Lynk & Co","Maserati","Maybach","Mazda","MCLaren","Mercedes-Benz","MG","MINI","Mitsubishi","Nikola","NIO","Nissan","Opel","Pagani","Peugeot","Polestar","Porsche","Qoros","Range Rover","Ravon","Renault","Rimac","Rivian","Rolls-Royce","Saab","Saipa","SEAT","Skoda","Smart","SangYong","SSC North America","Stellantis","Subaru","Suzuki","Tata","Tesla","Torsus","Toyota","VinFast","Volkswagen","Volvo","Xpeng","Zotye"],s=["Durango","Ram","Challenger","Charger","Grand Caravan","X7","X5","X3","X6 M","X6","X1","X4","C3 Aircross","C5 Aircross","Duster","CR-V","Corolla","IS 200t","LS 500h","RX","ES 200/250/350","Hatchback","CX-5","Sedan","CX-30","CX-9","CX-3","MX-5 Roadster","Phantom","Camry","Polo","Cullinan","Ghost","Dawn","Duster","Arkana","Sandero","Logan","Trafic Fourgon","Logan MCV","Captur","Kadjar","RAV4","Rio","Creta","Solaris"],r=t=>Math.floor(Math.random()*t);var i,a,o,h;!function(t){t.PREV="prev",t.NEXT="next"}(i||(i={})),function(t){t.WINS="wins",t.TIME="time"}(a||(a={})),function(t){t.DESC="DESC",t.ASC="ASC"}(o||(o={})),function(t){t.DEFAULT="default",t.ASC="ASC",t.DESC="DESC"}(h||(h={}));var l=function(t,e,n,s){return new(n||(n=Promise))((function(r,i){function a(t){try{h(s.next(t))}catch(t){i(t)}}function o(t){try{h(s.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,o)}h((s=s.apply(t,e||[])).next())}))};class c{constructor(){this.currentGaragePage=1,this.currentWinnersPage=1,this.basePath="http://127.0.0.1:3000",this.garagePath=`${this.basePath}/garage`,this.enginePath=`${this.basePath}/engine`,this.winnersPath=`${this.basePath}/winners`}getCars(){return l(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this.garagePath}?_page=${this.currentGaragePage}&_limit=7`);if(!t.ok)throw new Error("Fetch request failed");const e=t.headers.get("X-Total-Count");if(!e)throw new Error("Header is not set");return{items:yield t.json(),count:e}}catch(t){throw console.error(t),new Error("getCars request failed")}}))}getCarsCount(){return l(this,void 0,void 0,(function*(){const t=yield this.getCars();return Number(t.count)}))}getWinnersCount(){return l(this,void 0,void 0,(function*(){const t=yield this.getWinners();return Number(t.count)}))}getCar(t){return l(this,void 0,void 0,(function*(){return(yield fetch(`${this.garagePath}/${t}`)).json()}))}createCar(t){return l(this,void 0,void 0,(function*(){try{const e=yield fetch(this.garagePath,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("Fetch request failed");return yield e.json()}catch(t){throw console.error(t),new Error("createCar request failed")}}))}deleteCar(t){return l(this,void 0,void 0,(function*(){try{const e=yield fetch(`${this.garagePath}/${t}`,{method:"DELETE"});if(!e.ok)throw new Error("Fetch request failed");return yield e.json()}catch(t){throw console.error(t),new Error("deleteCar request failed")}}))}updateCar(t,e){return l(this,void 0,void 0,(function*(){try{const n=yield fetch(`${this.garagePath}/${t}`,{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error("Fetch request failed");return yield n.json()}catch(t){throw console.error(t),new Error("updateCar request failed")}}))}startEngine(t){return l(this,void 0,void 0,(function*(){try{const e=yield fetch(`${this.enginePath}?id=${t}&status=started`,{method:"PATCH"});if(!e.ok)throw new Error("Fetch request failed");return yield e.json()}catch(t){throw console.error(t),new Error("startEngine request failed")}}))}stopEngine(t){return l(this,void 0,void 0,(function*(){try{const e=yield fetch(`${this.enginePath}?id=${t}&status=stopped`,{method:"PATCH"});if(!e.ok)throw new Error("Fetch request failed");return yield e.json()}catch(t){throw console.error(t),new Error("startEngine request failed")}}))}switchEngine(t){return l(this,void 0,void 0,(function*(){const e=yield fetch(`${this.enginePath}?id=${t}&status=drive`,{method:"PATCH"});return e.ok?Object.assign({},yield e.json()):{success:!1}}))}switchCurrentGaragePage(t){return l(this,void 0,void 0,(function*(){const e=yield this.getCarsCount(),n=Math.ceil(e/7);return t===i.NEXT&&(this.currentGaragePage=this.currentGaragePage===n?n:this.currentGaragePage+1),t===i.PREV&&(this.currentGaragePage=1===this.currentGaragePage?1:this.currentGaragePage-1),this.currentGaragePage}))}switchCurrentWinnersPage(t){return l(this,void 0,void 0,(function*(){const e=yield this.getWinnersCount(),n=Math.ceil(e/10);return t===i.NEXT&&(this.currentWinnersPage=this.currentWinnersPage===n?n:this.currentWinnersPage+1),t===i.PREV&&(this.currentWinnersPage=1===this.currentWinnersPage?1:this.currentWinnersPage-1),this.currentWinnersPage}))}getCurrentGaragePage(){return this.currentGaragePage}getCurrentWinnersPage(){return this.currentWinnersPage}getWinners(){return l(this,void 0,void 0,(function*(){try{let t;if(this.currentSortOrder){const[e,n]=this.currentSortOrder;t=yield fetch(`${this.winnersPath}?_page=${this.currentWinnersPage}&_limit=10&_sort=${e}&_order=${n}`)}else t=yield fetch(`${this.winnersPath}?_page=${this.currentWinnersPage}&_limit=10`);if(!t.ok)throw new Error("Fetch request failed");const e=t.headers.get("X-Total-Count");if(!e)throw new Error("Header is not set");return{items:yield t.json(),count:e}}catch(t){throw console.error(t),new Error("getCars request failed")}}))}getWinner(t){return l(this,void 0,void 0,(function*(){return(yield fetch(`${this.winnersPath}/${t}`)).json()}))}createWinner(t){return l(this,void 0,void 0,(function*(){return(yield fetch(this.winnersPath,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json()}))}updateWinner(t,e){return l(this,void 0,void 0,(function*(){return(yield fetch(`${this.winnersPath}/${t}`,{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json()}))}getWinnerHTTPStatus(t){return l(this,void 0,void 0,(function*(){return(yield fetch(`${this.winnersPath}/${t}`)).status}))}saveWinner(t,e){return l(this,void 0,void 0,(function*(){if(404===(yield this.getWinnerHTTPStatus(t)))this.createWinner(e);else{const{wins:n,time:s}=yield this.getWinner(t);this.updateWinner(t,{wins:n+1,time:e.time<s?e.time:s})}}))}deleteWinner(t){return l(this,void 0,void 0,(function*(){return 200===(yield this.getWinnerHTTPStatus(t))&&(yield fetch(`${this.winnersPath}/${t}`,{method:"DELETE"}),!0)}))}setSortOrder(t){this.currentSortOrder=t}}class d extends t{constructor(){super("input"),this.setAttribute("type","color").setClass("bg-slate-300 rounded cursor-pointer")}getColorInput(){if(this.element instanceof HTMLInputElement)return this.element.value;throw new Error("Element is not instance of HTMLInputElement")}setColorInput(t){if(!(this.element instanceof HTMLInputElement))throw new Error("Element is not instance of HTMLInputElement");this.element.value=t}}class g extends t{constructor(){super("input"),this.setAttribute("type","text").setAttribute("autocomplete","off").setClass("px-2 text-slate-700 font-semibold bg-slate-300 rounded outline-indigo-300 cursor-pointer")}getTextInput(){if(this.element instanceof HTMLInputElement)return this.element.value;throw new Error("Element is not instance of HTMLInputElement")}setTextInput(t){if(!(this.element instanceof HTMLInputElement))throw new Error("Element is not instance of HTMLInputElement");this.element.value=t}}class u extends t{constructor(t){super("div"),this.onUpdate=t,this.setClass("flex gap-x-4"),this.openedCarID=null,this.searchBar=(new g).attachTo(this),this.colorPicker=(new d).attachTo(this),this.btn=new e("update","dark").attachTo(this),this.writingModeOff()}open({name:t,color:e,id:n}){this.writingModeOn(),this.searchBar.setTextInput(t),this.colorPicker.setColorInput(e),this.openedCarID=n,this.btn.setHandler("click",(()=>{this.openedCarID&&(this.onUpdate(this.openedCarID,{name:this.searchBar.getTextInput(),color:this.colorPicker.getColorInput()}),this.writingModeOff())}),{once:!0})}close(){this.writingModeOff()}writingModeOn(){[this.searchBar,this.colorPicker].forEach((t=>t.removeClass("opacity-50 cursor-not-allowed").setClass("cursor-pointer"))),this.btn.enable()}writingModeOff(){[this.searchBar,this.colorPicker].forEach((t=>t.removeClass("cursor-pointer").setClass("opacity-50 cursor-not-allowed"))),this.btn.disable(),this.searchBar.setTextInput(""),this.colorPicker.setColorInput("#000000")}getOpenedCarId(){return this.openedCarID}}const C=[{left:"2%"},{left:"91%"}];class w extends t{constructor(n,s,r,i,a){super("div"),this.carData=n,this.onSelectCar=s,this.onDeleteCar=r,this.onDriveCar=i,this.onStopCar=a,this.setClass("flex flex-col gap-y-3"),this.carElement=new t("div"),this.driveBtn=new e("A","dark"),this.stopBtn=new e("B","dark"),this.selectBtn=new e("select","light"),this.removeBtn=new e("remove","light"),this.createTrackControls(this.carData.name,this.carData.id).attachTo(this),this.createCarTrack().attachTo(this.createEngineControls().attachTo(this))}createTrackControls(e,n){const s=new t("div").setClass("flex gap-x-2");return this.selectBtn.setHandler("click",(()=>{"disabled"!==this.selectBtn.getStatus()&&this.onSelectCar(n)})).attachTo(s),this.removeBtn.setHandler("click",(()=>{"disabled"!==this.removeBtn.getStatus()&&this.onDeleteCar(n)})).attachTo(s),new t("div").setClass("ml-2 font-semibold text-md").setInnerText(e).attachTo(s),s}createEngineControls(){const e=new t("div").setClass("flex items-center gap-x-2");return this.driveBtn.attachTo(e).removeClass("bg-indigo-200 w-max").setClass("w-6 h-6 bg-emerald-200 rounded-full").setHandler("click",(()=>{"disabled"!==this.driveBtn.getStatus()&&(this.driveModeOn(),this.onDriveCar(this.carData.id,this.carData.name))})),this.stopBtn.attachTo(e).removeClass("bg-indigo-200 w-max").setClass("w-6 h-6 bg-emerald-200 rounded-full").disable().setHandler("click",(()=>{"disabled"!==this.stopBtn.getStatus()&&(this.driveModeOff(),this.onStopCar(this.carData.id))})),e}createCarTrack(){const e=new t("div").setClass("relative flex-grow flex max-w-[90rem] h-8 ml-3 bg-slate-400 rounded");return this.carElement.setClass("w-8 h-8 absolute left-[2%]").setInnerHTML(` <svg class="w-full h-full rotate-90" style="fill: ${this.carData.color};">\n          <use xlink:href="#car-top-view"></use>\n        </svg>`).attachTo(e),new t("div").setClass("absolute right-[9%] w-8 h-8").setInnerHTML(' <svg class="w-full h-full stroke-indigo-100 fill-indigo-100 rotate-90">\n          <use xlink:href="#finish-line"></use>\n        </svg>').attachTo(e),e}doDriveAnimation(t){this.carAnimation&&this.carAnimation.cancel(),this.carAnimation=this.carElement.animate(C,(t=>({fill:"forwards",duration:t}))(t))}doBreakAnimation(){this.carAnimation&&this.carAnimation.pause()}doStopAnimation(){this.carAnimation&&this.carAnimation.cancel()}driveModeOn(){this.driveBtn.disable(),this.stopBtn.enable(),this.selectBtn.disable(),this.removeBtn.disable()}driveModeOff(){this.driveBtn.enable(),this.stopBtn.disable(),this.selectBtn.enable(),this.removeBtn.enable()}drive(){return this.driveModeOn(),this.onDriveCar(this.carData.id,this.carData.name)}stop(){this.driveModeOff(),this.onStopCar(this.carData.id)}}class p extends t{constructor(n,s,r,i,a){super("div"),this.onSwitchPage=n,this.onSelectCar=s,this.onDeleteCar=r,this.onDriveCar=i,this.onStopCar=a,this.carTracks=new Map,this.setClass("flex flex-col xl:w-5/6 gap-y-2 pt-8"),this.garageCounter=new t("p").setClass(["font-bold","text-2xl","capitalize"]).attachTo(this),this.pageCounter=new t("p").setClass(["font-semibold","text-lg","capitalize"]).setInnerText("Page #1"),this.prevBtn=new e("prev","dark"),this.nextBtn=new e("next","dark"),this.createPageControls().attachTo(this),this.pageElement=new t("div").setClass("flex-grow flex flex-col gap-y-6 pt-4 pb-6").attachTo(this)}createPageControls(){const e=new t("div").setClass("flex items-center gap-x-3");return this.pageCounter.attachTo(e),this.prevBtn.attachTo(e).disable().setHandler("click",(()=>{"disabled"!==this.prevBtn.getStatus()&&this.onSwitchPage(i.PREV).then((t=>this.setPageCounter(t)))})),this.nextBtn.attachTo(e).disable().setHandler("click",(()=>{"disabled"!==this.nextBtn.getStatus()&&this.onSwitchPage(i.NEXT).then((t=>this.setPageCounter(t)))})),e}renderPage({items:t,count:e}){this.pageElement.clearInnerHTML(),this.garageCounter.setInnerText(`Garage (${e})`),this.carTracks.clear(),t.forEach((t=>{const e=new w(t,this.onSelectCar,this.onDeleteCar,this.onDriveCar,this.onStopCar);this.carTracks.set(e.carData.id,e),e.attachTo(this.pageElement)}))}setPageCounter(t){this.pageCounter.setInnerText(`Page #${t}`)}disableNextBtn(){this.nextBtn.disable()}enableNextBtn(){this.nextBtn.enable()}disablePrevBtn(){this.prevBtn.disable()}enablePrevBtn(){this.prevBtn.enable()}getCarTracks(){return this.carTracks}}class m extends t{constructor(){super("div"),this.setClass(["hidden","fixed","inset-0","flex","justify-center","items-center","bg-slate-900/50","z-10","hover:cursor-pointer"]),this.setHandler("click",(t=>{const{target:e}=t;null!=e&&e===this.element&&this.hide()}));const n=new t("div").attachTo(this).setClass(["relative","flex","flex-col","items-center","gap-y-5","min-w-48","px-2","py-3","bg-gray-100","rounded-md","hover:cursor-default"]);this.textElement=new t("p").setClass("font-semibold text-3xl text-slate-600 text-center").attachTo(n),new e("Close","dark").attachTo(n).setHandler("click",(()=>this.hide()))}open(t,e){this.removeClass("hidden"),this.textElement.setInnerText(`${t} wins! [${e}s]`)}hide(){this.setClass("hidden")}}class f extends t{constructor(t,n,s,r,i,a,o,h,l,c){super("section"),this.onCreateCar=t,this.onSelectCar=n,this.onUpdateCar=s,this.onDeleteCar=r,this.onSwitchPage=i,this.onGenerateCars=a,this.onDriveCar=o,this.onStopCar=h,this.onStartRace=l,this.onResetRace=c,this.setClass("self-stretch flex flex-col xl:items-center xl:min-w-full"),this.carUpdateField=new u(this.onUpdateCar),this.raceBtn=new e("race","light"),this.resetBtn=new e("reset","light"),this.pagination=new p(this.onSwitchPage,this.onSelectCar,this.onDeleteCar,this.onDriveCar,this.onStopCar),this.winMessage=new m,this.renderGeneralSettings(),this.pagination.attachTo(this),this.winMessage.attachTo(this)}renderGeneralSettings(){const e=new t("div").setClass("flex flex-col gap-y-3 max-w-sm pt-8").attachTo(this);this.createCarCreateField().attachTo(e),this.carUpdateField.attachTo(e),this.createGeneralBtns().attachTo(e)}createCarCreateField(){const n=new t("div").setClass("flex gap-x-4"),s=(new g).attachTo(n),r=(new d).attachTo(n);return new e("create","dark").setHandler("click",(()=>this.onCreateCar({name:s.getTextInput(),color:r.getColorInput()}))).attachTo(n),n}createGeneralBtns(){const n=new t("div").setClass("flex gap-x-3");return this.raceBtn.attachTo(n).setHandler("click",(()=>{"disabled"!==this.raceBtn.getStatus()&&this.onStartRace()})),this.resetBtn.attachTo(n).disable().setHandler("click",(()=>{"disabled"!==this.resetBtn.getStatus()&&(this.onResetRace(),this.resetBtn.disable(),setTimeout((()=>this.raceBtn.enable()),2500))})),new e("generate cars","dark").setClass("col-start-4 col-span-2").attachTo(n).setHandler("click",(()=>this.onGenerateCars())),n}renderPage(t){this.pagination.renderPage(t)}"openСarUpdate"(t){this.carUpdateField.open(t)}disableNextPageBtn(){this.pagination.disableNextBtn()}enableNextPageBtn(){this.pagination.enableNextBtn()}disablePrevPageBtn(){this.pagination.disablePrevBtn()}enablePrevPageBtn(){this.pagination.enablePrevBtn()}doDriveCarAnimation(t,e){const n=this.pagination.getCarTracks().get(t);if(!n)throw new Error(`No car with this id: ${t}`);n.doDriveAnimation(e)}doBreakCarAnimation(t){const e=this.pagination.getCarTracks().get(t);if(!e)throw new Error(`No car with this id: ${t}`);e.doBreakAnimation()}doStopCarAnimation(t){const e=this.pagination.getCarTracks().get(t);if(!e)throw new Error(`No car with this id: ${t}`);e.doStopAnimation()}getCarTracksArray(){return[...this.pagination.getCarTracks()].map((([,t])=>t))}openWinMessage(t,e){return this.winMessage.open(t,e)}raceModeOn(){this.raceBtn.disable(),this.resetBtn.disable()}raceModeOff(){this.resetBtn.enable()}}class v extends t{constructor(t){super("th"),this.name=t,this.state=h.DEFAULT,this.setClass("cursor-pointer"),this.setDefault()}setDefault(){return this.setInnerText(this.name),this.state=h.DEFAULT,this}setAscending(){return this.setInnerText(`${this.name}↑`),this.state=h.ASC,this}setDescending(){return this.setInnerText(`${this.name}↓`),this.state=h.DESC,this}getCurrentState(){return this.state}}class T extends t{constructor(e,n){super("table"),this.onGetCar=e,this.onSort=n,this.winsSortHandler=()=>{const t=this.winsSortBtn.getCurrentState();t===h.DEFAULT?(this.winsSortBtn.setDescending(),this.timeSortBtn.setDefault(),this.onSort([a.WINS,o.DESC])):t===h.DESC?(this.winsSortBtn.setAscending(),this.onSort([a.WINS,o.ASC])):t===h.ASC&&(this.winsSortBtn.setDefault(),this.onSort())},this.timeSortHandler=()=>{const t=this.timeSortBtn.getCurrentState();t===h.DEFAULT?(this.timeSortBtn.setDescending(),this.winsSortBtn.setDefault(),this.onSort([a.TIME,o.DESC])):t===h.DESC?(this.timeSortBtn.setAscending(),this.onSort([a.TIME,o.ASC])):t===h.ASC&&(this.timeSortBtn.setDefault(),this.onSort())},this.setClass("cursor-default"),this.setAttribute("sortable"),this.head=new t("thead").attachTo(this),this.body=new t("tbody").attachTo(this),this.winsSortBtn=new v("Wins"),this.timeSortBtn=new v("Best time (seconds)"),this.renderHeaders()}renderHeaders(){const e=new t("tr").setClass("min-h-8 bg-blue-500 text-md text-white").attachTo(this.head);new t("th").setInnerText("Number").attachTo(e),new t("th").setInnerText("Car").attachTo(e),new t("th").setInnerText("Name").attachTo(e),this.winsSortBtn.attachTo(e).setHandler("click",this.winsSortHandler),this.timeSortBtn.attachTo(e).setHandler("click",this.timeSortHandler)}renderPage(e,n){this.body.clearInnerHTML(),e.forEach((({wins:e,time:s,id:r},i)=>{const a=new t("tr").setClass("text-center text-md font-medium").attachTo(this.body);this.onGetCar(r).then((({name:r,color:o})=>{new t("td").setInnerText(`${10*(n-1)+i+1}`).attachTo(a),new t("td").setInnerHTML(` <svg class="w-7 h-7 rotate-90" style="fill: ${o};">\n                <use xlink:href="#car-top-view"></use>\n              </svg>`).attachTo(a),new t("td").setInnerText(`${r}`).attachTo(a),new t("td").setInnerText(`${e}`).attachTo(a),new t("td").setInnerText(`${s}s`).attachTo(a)}))}))}}class b extends t{constructor(n,s,r){super("section"),this.onGetCar=n,this.onSwitchPage=s,this.onSortWinners=r,this.setClass("flex flex-col xl:w-5/6 gap-y-2 pt-8"),this.winnersCounter=new t("p").setClass(["font-bold","text-2xl","capitalize"]).setInnerText("Winners (4)").attachTo(this),this.pageCounter=new t("p").setClass(["font-semibold","text-lg","capitalize"]).setInnerText("Page #1"),this.prevBtn=new e("prev","dark"),this.nextBtn=new e("next","dark"),this.renderPageControls().attachTo(this),this.leaderboard=new T(this.onGetCar,this.onSortWinners).attachTo(this)}renderPageControls(){const e=new t("div").setClass("flex items-center gap-x-3");return this.pageCounter.attachTo(e),this.prevBtn.attachTo(e).disable().setHandler("click",(()=>{"disabled"!==this.prevBtn.getStatus()&&this.onSwitchPage(i.PREV).then((t=>this.setPageCounter(t)))})),this.nextBtn.attachTo(e).disable().setHandler("click",(()=>{"disabled"!==this.nextBtn.getStatus()&&this.onSwitchPage(i.NEXT).then((t=>this.setPageCounter(t)))})),e}renderPage({items:t,count:e},n){this.winnersCounter.setInnerText(`Winners (${e})`),this.leaderboard.renderPage(t,n)}setPageCounter(t){this.pageCounter.setInnerText(`Page #${t}`)}disableNextPageBtn(){this.nextBtn.disable()}enableNextPageBtn(){this.nextBtn.enable()}disablePrevPageBtn(){this.prevBtn.disable()}enablePrevPageBtn(){this.prevBtn.enable()}}window.addEventListener("DOMContentLoaded",(()=>{alert("Привет. Прошу, не забудь включить/перезагрузить сервер перед проверкой. Спасибо!")}));const P=new t("div").setAttribute("id","root").attachTo(document.body),x=new class{constructor(e){this.getCarCallback=t=>this.model.getCar(t),this.selectCarCallback=t=>{this.model.getCar(t).then((t=>this.garageView.openСarUpdate(t)))},this.updateCarCallback=(t,e)=>{this.model.updateCar(t,e).then((()=>this.renderGaragePage()))},this.createCarCallback=t=>{this.model.createCar(t).then((()=>this.renderGaragePage()))},this.deleteCarCallback=t=>{this.model.deleteCar(t).then((()=>{const e=this.garageView.carUpdateField.getOpenedCarId();e&&e===t&&this.garageView.carUpdateField.writingModeOff(),this.renderGaragePage()})),this.model.deleteWinner(t).then((t=>{t&&this.renderWinnersPage()}))},this.generateCarsCallback=(t=100)=>{const e=new Array(t).fill("").map((()=>{const t={name:`${n[r(n.length)]} ${s[r(s.length)]}`,color:`#${Math.floor(16777215*Math.random()).toString(16)}`};return this.model.createCar(t)}));Promise.all(e).then((()=>this.renderGaragePage()))},this.driveCarCallback=(t,e)=>this.model.startEngine(t).then((n=>{const s=n.distance/n.velocity;this.garageView.doDriveCarAnimation(t,s);const r=Date.now();return new Promise((n=>{this.model.switchEngine(t).then((i=>{i.success||this.garageView.doBreakCarAnimation(t);const a=Date.now()-r;i.success&&setTimeout((()=>n({name:e,id:t,duration:s})),s-a)}))}))})),this.stopCarCallback=t=>{this.model.stopEngine(t).then((()=>this.garageView.doStopCarAnimation(t)))},this.startRaceCallback=()=>{const t=this.garageView.getCarTracksArray().map((t=>t.drive()));this.garageView.raceModeOn(),Promise.race(t).then((({id:t,name:e,duration:n})=>{return s=this,r=void 0,a=function*(){const s=new Date(n),r=s.getUTCSeconds(),i=s.getUTCMilliseconds(),a=parseFloat(`${r}.${i}`);this.garageView.openWinMessage(e,a),this.garageView.raceModeOff(),this.model.saveWinner(t,{id:t,wins:1,time:a}).then((()=>this.renderWinnersPage()))},new((i=void 0)||(i=Promise))((function(t,e){function n(t){try{h(a.next(t))}catch(t){e(t)}}function o(t){try{h(a.throw(t))}catch(t){e(t)}}function h(e){var s;e.done?t(e.value):(s=e.value,s instanceof i?s:new i((function(t){t(s)}))).then(n,o)}h((a=a.apply(s,r||[])).next())}));var s,r,i,a}))},this.resetRaceCallback=()=>{this.garageView.getCarTracksArray().forEach((t=>t.stop()))},this.switchGaragePageCallback=t=>this.model.switchCurrentGaragePage(t).finally((()=>this.renderGaragePage())),this.switchWinnersPageCallback=t=>this.model.switchCurrentWinnersPage(t).finally((()=>this.renderWinnersPage())),this.sortWinnersCallback=t=>{this.model.setSortOrder(t),this.renderWinnersPage()},this.model=new c,this.container=new t("main").setClass("flex flex-col xl:items-center min-h-screen px-2 text-slate-300 bg-slate-700").attachTo(e),this.renderHeader(),this.renderRoutingBtns(),this.garageView=new f(this.createCarCallback,this.selectCarCallback,this.updateCarCallback,this.deleteCarCallback,this.switchGaragePageCallback,this.generateCarsCallback,this.driveCarCallback,this.stopCarCallback,this.startRaceCallback,this.resetRaceCallback),this.winnersView=new b(this.getCarCallback,this.switchWinnersPageCallback,this.sortWinnersCallback),this.routes={garage:this.garageView,winners:this.winnersView},this.handleRouteChange(),window.onpopstate=()=>this.handleRouteChange()}handleRouteChange(){const t=window.location.hash.slice(1).toLowerCase(),e=t in this.routes?this.routes[t]:this.routes.garage;e!==this.activeView&&(this.activeView&&this.activeView.remove(),this.activeView=e,this.activeView.attachTo(this.container))}renderHeader(){new t("header").setClass("pt-3 text-5xl font-bold tracking-wide").setInnerText("Async Race").attachTo(this.container)}renderRoutingBtns(){const n=new t("div").setClass("flex gap-x-2 pt-4").attachTo(this.container);new e("garage","light").attachTo(n).setHandler("click",(()=>{window.location.href="#garage"})),new e("winners","light").attachTo(n).setHandler("click",(()=>{window.location.href="#winners"}))}renderGaragePage(){this.model.getCars().then((t=>{this.garageView.renderPage(t);const e=Number(t.count)>7*this.model.getCurrentGaragePage(),n=this.model.getCurrentGaragePage()>1;e?this.garageView.enableNextPageBtn():this.garageView.disableNextPageBtn(),n?this.garageView.enablePrevPageBtn():this.garageView.disablePrevPageBtn()}))}renderWinnersPage(){this.model.getWinners().then((t=>{this.winnersView.renderPage(t,this.model.getCurrentWinnersPage());const e=Number(t.count)>10*this.model.getCurrentWinnersPage(),n=this.model.getCurrentWinnersPage()>1;e?this.winnersView.enableNextPageBtn():this.winnersView.disableNextPageBtn(),n?this.winnersView.enablePrevPageBtn():this.winnersView.disablePrevPageBtn()}))}start(){this.renderGaragePage(),this.renderWinnersPage()}}(P);x.start()}();