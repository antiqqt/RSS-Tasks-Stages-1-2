!function(){"use strict";class e{element;constructor(e){this.element=document.createElement(e)}attachTo(t){return t instanceof e?t.element.append(this.element):t.append(this.element),this}setClass(e){const t=Array.isArray(e)?e:e.split(" ");return this.element.classList.add(...t),this}removeClass(e){const t=Array.isArray(e)?e:e.split(" ");return this.element.classList.remove(...t),this}setAttribute(e,t=""){return this.element.setAttribute(e,t),this}setInnerText(e){return this.element.innerText=e,this}setHandler(e,t,a){return this.element.addEventListener(e,t,a),this}setInnerHTML(e){return this.element.innerHTML=e,this}clearInnerHTML(){return this.element.innerHTML="",this}remove(){return this.element.remove(),this}animate(e,t){return this.element.animate(e,t)}}class t extends e{status;constructor(e,t){super("button"),this.setInnerText(e).setClass(["flex","justify-center","items-center","w-max","h-6","px-2","py-1","font-medium","text-gray-600","capitalize","border-2","border-transparent","rounded","transition-colors","cursor-pointer"]),"light"===t?this.setClass("bg-yellow-100 hover:border-indigo-400"):this.setClass("bg-indigo-200 hover:border-indigo-400"),this.status="enabled"}enable(){return this.removeClass("cursor-not-allowed opacity-50"),this.setClass("cursor-pointer hover:border-indigo-400 opacity-100"),this.status="enabled",this}disable(){return this.removeClass("cursor-pointer hover:border-indigo-400 opacity-100"),this.setClass("cursor-not-allowed opacity-50"),this.status="disabled",this}getStatus(){return this.status}}const a=["Acura","Alfa Romeo","Alpine","Apollo","Apple","Aston Martin","Audi","Automobili Pininfarina","Bentley","BMW","Bollinger","Brilliance","Bugatti","Buick","BYD","Cadillac","Chana","Chery","Chevrolet","Chrysler","Citroen","Continental","CUPRA","Dacia","Daewoo","Daihatsu","Datsun","Detroit Electric","Dodge","DS Automobiles","FAW","Ferrari","Fiat","Fisker","Ford","Foxtron","Geely","Genesis","GMC","Great Wall","Haval","Honda","Hummer","Hyundai","Ineos","Infiniti","Iran Khodro","JAC","Jaguar","Jeep","JETOUR","KIA","Koenigsegg","Lada","Lamborghini","Lancia","Land Rover","Lexus","Lifan","Lincoln","Lordstown","Lotus","Lucid","LvChi","Lynk & Co","Maserati","Maybach","Mazda","MCLaren","Mercedes-Benz","MG","MINI","Mitsubishi","Nikola","NIO","Nissan","Opel","Pagani","Peugeot","Polestar","Porsche","Qoros","Range Rover","Ravon","Renault","Rimac","Rivian","Rolls-Royce","Saab","Saipa","SEAT","Skoda","Smart","SangYong","SSC North America","Stellantis","Subaru","Suzuki","Tata","Tesla","Torsus","Toyota","VinFast","Volkswagen","Volvo","Xpeng","Zotye"],n=["Durango","Ram","Challenger","Charger","Grand Caravan","X7","X5","X3","X6 M","X6","X1","X4","C3 Aircross","C5 Aircross","Duster","CR-V","Corolla","IS 200t","LS 500h","RX","ES 200/250/350","Hatchback","CX-5","Sedan","CX-30","CX-9","CX-3","MX-5 Roadster","Phantom","Camry","Polo","Cullinan","Ghost","Dawn","Duster","Arkana","Sandero","Logan","Trafic Fourgon","Logan MCV","Captur","Kadjar","RAV4","Rio","Creta","Solaris"],s=e=>Math.floor(Math.random()*e);var r,i,o,h;!function(e){e.PREV="prev",e.NEXT="next"}(r||(r={})),function(e){e.WINS="wins",e.TIME="time"}(i||(i={})),function(e){e.DESC="DESC",e.ASC="ASC"}(o||(o={})),function(e){e.DEFAULT="default",e.ASC="ASC",e.DESC="DESC"}(h||(h={}));class l{basePath;garagePath;enginePath;winnersPath;currentGaragePage=1;currentWinnersPage=1;currentSortOrder;constructor(){this.basePath="http://127.0.0.1:3000",this.garagePath=`${this.basePath}/garage`,this.enginePath=`${this.basePath}/engine`,this.winnersPath=`${this.basePath}/winners`}async getCars(){try{const e=await fetch(`${this.garagePath}?_page=${this.currentGaragePage}&_limit=7`);if(!e.ok)throw new Error("Fetch request failed");const t=e.headers.get("X-Total-Count");if(!t)throw new Error("Header is not set");return{items:await e.json(),count:t}}catch(e){throw console.error(e),new Error("getCars request failed")}}async getCarsCount(){const e=await this.getCars();return Number(e.count)}async getWinnersCount(){const e=await this.getWinners();return Number(e.count)}async getCar(e){return(await fetch(`${this.garagePath}/${e}`)).json()}async createCar(e){try{const t=await fetch(this.garagePath,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Fetch request failed");return await t.json()}catch(e){throw console.error(e),new Error("createCar request failed")}}async deleteCar(e){try{const t=await fetch(`${this.garagePath}/${e}`,{method:"DELETE"});if(!t.ok)throw new Error("Fetch request failed");return await t.json()}catch(e){throw console.error(e),new Error("deleteCar request failed")}}async updateCar(e,t){try{const a=await fetch(`${this.garagePath}/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Fetch request failed");return await a.json()}catch(e){throw console.error(e),new Error("updateCar request failed")}}async startEngine(e){try{const t=await fetch(`${this.enginePath}?id=${e}&status=started`,{method:"PATCH"});if(!t.ok)throw new Error("Fetch request failed");return await t.json()}catch(e){throw console.error(e),new Error("startEngine request failed")}}async stopEngine(e){try{const t=await fetch(`${this.enginePath}?id=${e}&status=stopped`,{method:"PATCH"});if(!t.ok)throw new Error("Fetch request failed");return await t.json()}catch(e){throw console.error(e),new Error("startEngine request failed")}}async switchEngine(e){const t=await fetch(`${this.enginePath}?id=${e}&status=drive`,{method:"PATCH"});return t.ok?{...await t.json()}:{success:!1}}async switchCurrentGaragePage(e){const t=await this.getCarsCount(),a=Math.ceil(t/7);return e===r.NEXT&&(this.currentGaragePage=this.currentGaragePage===a?a:this.currentGaragePage+1),e===r.PREV&&(this.currentGaragePage=1===this.currentGaragePage?1:this.currentGaragePage-1),this.currentGaragePage}async switchCurrentWinnersPage(e){const t=await this.getWinnersCount(),a=Math.ceil(t/10);return e===r.NEXT&&(this.currentWinnersPage=this.currentWinnersPage===a?a:this.currentWinnersPage+1),e===r.PREV&&(this.currentWinnersPage=1===this.currentWinnersPage?1:this.currentWinnersPage-1),this.currentWinnersPage}getCurrentGaragePage(){return this.currentGaragePage}getCurrentWinnersPage(){return this.currentWinnersPage}async getWinners(){try{let e;if(this.currentSortOrder){const[t,a]=this.currentSortOrder;e=await fetch(`${this.winnersPath}?_page=${this.currentWinnersPage}&_limit=10&_sort=${t}&_order=${a}`)}else e=await fetch(`${this.winnersPath}?_page=${this.currentWinnersPage}&_limit=10`);if(!e.ok)throw new Error("Fetch request failed");const t=e.headers.get("X-Total-Count");if(!t)throw new Error("Header is not set");return{items:await e.json(),count:t}}catch(e){throw console.error(e),new Error("getCars request failed")}}async getWinner(e){return(await fetch(`${this.winnersPath}/${e}`)).json()}async createWinner(e){return(await fetch(this.winnersPath,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json()}async updateWinner(e,t){return(await fetch(`${this.winnersPath}/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json()}async getWinnerHTTPStatus(e){return(await fetch(`${this.winnersPath}/${e}`)).status}async saveWinner(e,t){if(404===await this.getWinnerHTTPStatus(e))this.createWinner(t);else{const{wins:a,time:n}=await this.getWinner(e);this.updateWinner(e,{wins:a+1,time:t.time<n?t.time:n})}}async deleteWinner(e){return 200===await this.getWinnerHTTPStatus(e)&&(await fetch(`${this.winnersPath}/${e}`,{method:"DELETE"}),!0)}setSortOrder(e){this.currentSortOrder=e}}class c extends e{constructor(){super("input"),this.setAttribute("type","color").setClass("bg-slate-300 rounded cursor-pointer")}getColorInput(){if(this.element instanceof HTMLInputElement)return this.element.value;throw new Error("Element is not instance of HTMLInputElement")}setColorInput(e){if(!(this.element instanceof HTMLInputElement))throw new Error("Element is not instance of HTMLInputElement");this.element.value=e}}class d extends e{constructor(){super("input"),this.setAttribute("type","text").setAttribute("autocomplete","off").setClass("px-2 text-slate-700 font-semibold bg-slate-300 rounded outline-indigo-300 cursor-pointer")}getTextInput(){if(this.element instanceof HTMLInputElement)return this.element.value;throw new Error("Element is not instance of HTMLInputElement")}setTextInput(e){if(!(this.element instanceof HTMLInputElement))throw new Error("Element is not instance of HTMLInputElement");this.element.value=e}}class g extends e{onUpdate;searchBar;colorPicker;btn;openedCarID;constructor(e){super("div"),this.onUpdate=e,this.setClass("flex gap-x-4"),this.openedCarID=null,this.searchBar=(new d).attachTo(this),this.colorPicker=(new c).attachTo(this),this.btn=new t("update","dark").attachTo(this),this.writingModeOff()}open({name:e,color:t,id:a}){this.writingModeOn(),this.searchBar.setTextInput(e),this.colorPicker.setColorInput(t),this.openedCarID=a,this.btn.setHandler("click",(()=>{this.openedCarID&&(this.onUpdate(this.openedCarID,{name:this.searchBar.getTextInput(),color:this.colorPicker.getColorInput()}),this.writingModeOff())}),{once:!0})}close(){this.writingModeOff()}writingModeOn(){[this.searchBar,this.colorPicker].forEach((e=>e.removeClass("opacity-50 cursor-not-allowed").setClass("cursor-pointer"))),this.btn.enable()}writingModeOff(){[this.searchBar,this.colorPicker].forEach((e=>e.removeClass("cursor-pointer").setClass("opacity-50 cursor-not-allowed"))),this.btn.disable(),this.searchBar.setTextInput(""),this.colorPicker.setColorInput("#000000")}getOpenedCarId(){return this.openedCarID}}const u=[{left:"2%"},{left:"91%"}];class C extends e{carData;onSelectCar;onDeleteCar;onDriveCar;onStopCar;carElement;carAnimation;driveBtn;stopBtn;selectBtn;removeBtn;constructor(a,n,s,r,i){super("div"),this.carData=a,this.onSelectCar=n,this.onDeleteCar=s,this.onDriveCar=r,this.onStopCar=i,this.setClass("flex flex-col gap-y-3"),this.carElement=new e("div"),this.driveBtn=new t("A","dark"),this.stopBtn=new t("B","dark"),this.selectBtn=new t("select","light"),this.removeBtn=new t("remove","light"),this.createTrackControls(this.carData.name,this.carData.id).attachTo(this),this.createCarTrack().attachTo(this.createEngineControls().attachTo(this))}createTrackControls(t,a){const n=new e("div").setClass("flex gap-x-2");return this.selectBtn.setHandler("click",(()=>{"disabled"!==this.selectBtn.getStatus()&&this.onSelectCar(a)})).attachTo(n),this.removeBtn.setHandler("click",(()=>{"disabled"!==this.removeBtn.getStatus()&&this.onDeleteCar(a)})).attachTo(n),new e("div").setClass("ml-2 font-semibold text-md").setInnerText(t).attachTo(n),n}createEngineControls(){const t=new e("div").setClass("flex items-center gap-x-2");return this.driveBtn.attachTo(t).removeClass("bg-indigo-200 w-max").setClass("w-6 h-6 bg-emerald-200 rounded-full").setHandler("click",(()=>{"disabled"!==this.driveBtn.getStatus()&&(this.driveModeOn(),this.onDriveCar(this.carData.id,this.carData.name).catch((()=>{})))})),this.stopBtn.attachTo(t).removeClass("bg-indigo-200 w-max").setClass("w-6 h-6 bg-emerald-200 rounded-full").disable().setHandler("click",(()=>{"disabled"!==this.stopBtn.getStatus()&&(this.driveModeOff(),this.onStopCar(this.carData.id))})),t}createCarTrack(){const t=new e("div").setClass("relative flex-grow flex max-w-[90rem] h-8 ml-3 bg-slate-400 rounded");return this.carElement.setClass("w-8 h-8 absolute left-[2%]").setInnerHTML(` <svg class="w-full h-full rotate-90" style="fill: ${this.carData.color};">\n          <use xlink:href="#car-top-view"></use>\n        </svg>`).attachTo(t),new e("div").setClass("absolute right-[9%] w-8 h-8").setInnerHTML(' <svg class="w-full h-full stroke-indigo-100 fill-indigo-100 rotate-90">\n          <use xlink:href="#finish-line"></use>\n        </svg>').attachTo(t),t}doDriveAnimation(e){this.carAnimation&&this.carAnimation.cancel(),this.carAnimation=this.carElement.animate(u,(e=>({fill:"forwards",duration:e}))(e))}doBreakAnimation(){this.carAnimation&&this.carAnimation.pause()}doStopAnimation(){this.carAnimation&&this.carAnimation.cancel()}driveModeOn(){this.driveBtn.disable(),setTimeout((()=>{this.stopBtn.enable()}),1500),this.selectBtn.disable(),this.removeBtn.disable()}driveModeOff(){setTimeout((()=>{this.driveBtn.enable()}),2e3),this.stopBtn.disable(),this.selectBtn.enable(),this.removeBtn.enable()}drive(){return this.driveModeOn(),this.onDriveCar(this.carData.id,this.carData.name)}stop(){this.driveModeOff(),this.onStopCar(this.carData.id)}}class w extends e{onSwitchPage;onSelectCar;onDeleteCar;onDriveCar;onStopCar;garageCounter;pageCounter;pageElement;nextBtn;prevBtn;carTracks=new Map;constructor(a,n,s,r,i){super("div"),this.onSwitchPage=a,this.onSelectCar=n,this.onDeleteCar=s,this.onDriveCar=r,this.onStopCar=i,this.setClass("flex flex-col xl:w-5/6 gap-y-2 pt-8"),this.garageCounter=new e("p").setClass(["font-bold","text-2xl","capitalize"]).attachTo(this),this.pageCounter=new e("p").setClass(["font-semibold","text-lg","capitalize"]).setInnerText("Page #1"),this.prevBtn=new t("prev","dark"),this.nextBtn=new t("next","dark"),this.createPageControls().attachTo(this),this.pageElement=new e("div").setClass("flex-grow flex flex-col gap-y-6 pt-4 pb-6").attachTo(this)}createPageControls(){const t=new e("div").setClass("flex items-center gap-x-3");return this.pageCounter.attachTo(t),this.prevBtn.attachTo(t).disable().setHandler("click",(()=>{"disabled"!==this.prevBtn.getStatus()&&this.onSwitchPage(r.PREV).then((e=>this.setPageCounter(e)))})),this.nextBtn.attachTo(t).disable().setHandler("click",(()=>{"disabled"!==this.nextBtn.getStatus()&&this.onSwitchPage(r.NEXT).then((e=>this.setPageCounter(e)))})),t}renderPage({items:e,count:t}){this.pageElement.clearInnerHTML(),this.garageCounter.setInnerText(`Garage (${t})`),this.carTracks.clear(),e.forEach((e=>{const t=new C(e,this.onSelectCar,this.onDeleteCar,this.onDriveCar,this.onStopCar);this.carTracks.set(t.carData.id,t),t.attachTo(this.pageElement)}))}setPageCounter(e){this.pageCounter.setInnerText(`Page #${e}`)}disableNextBtn(){this.nextBtn.disable()}enableNextBtn(){this.nextBtn.enable()}disablePrevBtn(){this.prevBtn.disable()}enablePrevBtn(){this.prevBtn.enable()}getCarTracks(){return this.carTracks}}class p extends e{textElement;constructor(){super("div"),this.setClass(["hidden","fixed","inset-0","flex","justify-center","items-center","bg-slate-900/50","z-10","hover:cursor-pointer"]),this.setHandler("click",(e=>{const{target:t}=e;null!=t&&t===this.element&&this.hide()}));const a=new e("div").attachTo(this).setClass(["relative","flex","flex-col","items-center","gap-y-5","min-w-48","px-2","py-3","bg-gray-100","rounded-md","hover:cursor-default"]);this.textElement=new e("p").setClass("font-semibold text-3xl text-slate-600 text-center").attachTo(a),new t("Close","dark").attachTo(a).setHandler("click",(()=>this.hide()))}open(e,t){this.removeClass("hidden"),t&&e?this.textElement.setInnerText(`${e} wins! [${t}s]`):this.textElement.setInnerText("No one wins! All cars were broken.")}hide(){this.setClass("hidden")}}class m extends e{onCreateCar;onSelectCar;onUpdateCar;onDeleteCar;onSwitchPage;onGenerateCars;onDriveCar;onStopCar;onStartRace;onResetRace;pagination;winMessage;carUpdateField;raceBtn;resetBtn;generateCarsBtn;constructor(e,a,n,s,r,i,o,h,l,c){super("section"),this.onCreateCar=e,this.onSelectCar=a,this.onUpdateCar=n,this.onDeleteCar=s,this.onSwitchPage=r,this.onGenerateCars=i,this.onDriveCar=o,this.onStopCar=h,this.onStartRace=l,this.onResetRace=c,this.setClass("self-stretch flex flex-col xl:items-center xl:min-w-full"),this.carUpdateField=new g(this.onUpdateCar),this.generateCarsBtn=new t("generate cars","dark"),this.raceBtn=new t("race","light"),this.resetBtn=new t("reset","light"),this.pagination=new w(this.onSwitchPage,this.onSelectCar,this.onDeleteCar,this.onDriveCar,this.onStopCar),this.winMessage=new p,this.renderGeneralSettings(),this.pagination.attachTo(this),this.winMessage.attachTo(this)}renderGeneralSettings(){const t=new e("div").setClass("flex flex-col gap-y-3 max-w-sm pt-8").attachTo(this);this.createCarCreateField().attachTo(t),this.carUpdateField.attachTo(t),this.createGeneralBtns().attachTo(t)}createCarCreateField(){const a=new e("div").setClass("flex gap-x-4"),n=(new d).attachTo(a),s=(new c).attachTo(a);return new t("create","dark").setHandler("click",(()=>this.onCreateCar({name:n.getTextInput(),color:s.getColorInput()}))).attachTo(a),a}createGeneralBtns(){const t=new e("div").setClass("flex gap-x-3");return this.raceBtn.attachTo(t).setHandler("click",(()=>{"disabled"!==this.raceBtn.getStatus()&&this.onStartRace()})),this.resetBtn.attachTo(t).disable().setHandler("click",(()=>{"disabled"!==this.resetBtn.getStatus()&&(this.onResetRace(),this.resetBtn.disable(),setTimeout((()=>{this.generateCarsBtn.enable(),this.raceBtn.enable()}),2500))})),this.generateCarsBtn.setClass("col-start-4 col-span-2").attachTo(t).setHandler("click",(()=>{"disabled"!==this.generateCarsBtn.getStatus()&&this.onGenerateCars()})),t}renderPage(e){this.pagination.renderPage(e)}"openСarUpdate"(e){this.carUpdateField.open(e)}disableNextPageBtn(){this.pagination.disableNextBtn()}enableNextPageBtn(){this.pagination.enableNextBtn()}disablePrevPageBtn(){this.pagination.disablePrevBtn()}enablePrevPageBtn(){this.pagination.enablePrevBtn()}doDriveCarAnimation(e,t){const a=this.pagination.getCarTracks().get(e);if(!a)throw new Error(`No car with this id: ${e}`);a.doDriveAnimation(t)}doBreakCarAnimation(e){const t=this.pagination.getCarTracks().get(e);if(!t)throw new Error(`No car with this id: ${e}`);t.doBreakAnimation()}doStopCarAnimation(e){const t=this.pagination.getCarTracks().get(e);if(!t)throw new Error(`No car with this id: ${e}`);t.doStopAnimation()}getCarTracksArray(){return[...this.pagination.getCarTracks()].map((([,e])=>e))}openWinMessage(e,t){return this.winMessage.open(e,t)}raceModeOn(){this.raceBtn.disable(),this.resetBtn.disable(),this.generateCarsBtn.disable()}raceModeOff(){this.resetBtn.enable()}}class f extends e{name;state=h.DEFAULT;constructor(e){super("th"),this.name=e,this.setClass("cursor-pointer"),this.setDefault()}setDefault(){return this.setInnerText(this.name),this.state=h.DEFAULT,this}setAscending(){return this.setInnerText(`${this.name}↑`),this.state=h.ASC,this}setDescending(){return this.setInnerText(`${this.name}↓`),this.state=h.DESC,this}getCurrentState(){return this.state}}class b extends e{onGetCar;onSort;head;body;winsSortBtn;timeSortBtn;constructor(t,a){super("table"),this.onGetCar=t,this.onSort=a,this.setClass("cursor-default"),this.setAttribute("sortable"),this.head=new e("thead").attachTo(this),this.body=new e("tbody").attachTo(this),this.winsSortBtn=new f("Wins"),this.timeSortBtn=new f("Best time (seconds)"),this.renderHeaders()}renderHeaders(){const t=new e("tr").setClass("min-h-8 bg-blue-500 text-md text-white").attachTo(this.head);new e("th").setInnerText("Number").attachTo(t),new e("th").setInnerText("Car").attachTo(t),new e("th").setInnerText("Name").attachTo(t),this.winsSortBtn.attachTo(t).setHandler("click",this.winsSortHandler),this.timeSortBtn.attachTo(t).setHandler("click",this.timeSortHandler)}renderPage(t,a){this.body.clearInnerHTML(),t.forEach((({wins:t,time:n,id:s},r)=>{const i=new e("tr").setClass("text-center text-md font-medium").attachTo(this.body);this.onGetCar(s).then((({name:s,color:o})=>{new e("td").setInnerText(`${10*(a-1)+r+1}`).attachTo(i),new e("td").setInnerHTML(` <svg class="w-7 h-7 rotate-90" style="fill: ${o};">\n                <use xlink:href="#car-top-view"></use>\n              </svg>`).attachTo(i),new e("td").setInnerText(`${s}`).attachTo(i),new e("td").setInnerText(`${t}`).attachTo(i),new e("td").setInnerText(`${n}s`).attachTo(i)}))}))}winsSortHandler=()=>{const e=this.winsSortBtn.getCurrentState();e===h.DEFAULT?(this.winsSortBtn.setDescending(),this.timeSortBtn.setDefault(),this.onSort([i.WINS,o.DESC])):e===h.DESC?(this.winsSortBtn.setAscending(),this.onSort([i.WINS,o.ASC])):e===h.ASC&&(this.winsSortBtn.setDefault(),this.onSort())};timeSortHandler=()=>{const e=this.timeSortBtn.getCurrentState();e===h.DEFAULT?(this.timeSortBtn.setDescending(),this.winsSortBtn.setDefault(),this.onSort([i.TIME,o.DESC])):e===h.DESC?(this.timeSortBtn.setAscending(),this.onSort([i.TIME,o.ASC])):e===h.ASC&&(this.timeSortBtn.setDefault(),this.onSort())}}class T extends e{onGetCar;onSwitchPage;onSortWinners;winnersCounter;pageCounter;leaderboard;nextBtn;prevBtn;constructor(a,n,s){super("section"),this.onGetCar=a,this.onSwitchPage=n,this.onSortWinners=s,this.setClass("flex flex-col xl:w-5/6 gap-y-2 pt-8"),this.winnersCounter=new e("p").setClass(["font-bold","text-2xl","capitalize"]).setInnerText("Winners (4)").attachTo(this),this.pageCounter=new e("p").setClass(["font-semibold","text-lg","capitalize"]).setInnerText("Page #1"),this.prevBtn=new t("prev","dark"),this.nextBtn=new t("next","dark"),this.renderPageControls().attachTo(this),this.leaderboard=new b(this.onGetCar,this.onSortWinners).attachTo(this)}renderPageControls(){const t=new e("div").setClass("flex items-center gap-x-3");return this.pageCounter.attachTo(t),this.prevBtn.attachTo(t).disable().setHandler("click",(()=>{"disabled"!==this.prevBtn.getStatus()&&this.onSwitchPage(r.PREV).then((e=>this.setPageCounter(e)))})),this.nextBtn.attachTo(t).disable().setHandler("click",(()=>{"disabled"!==this.nextBtn.getStatus()&&this.onSwitchPage(r.NEXT).then((e=>this.setPageCounter(e)))})),t}renderPage({items:e,count:t},a){this.winnersCounter.setInnerText(`Winners (${t})`),this.leaderboard.renderPage(e,a)}setPageCounter(e){this.pageCounter.setInnerText(`Page #${e}`)}disableNextPageBtn(){this.nextBtn.disable()}enableNextPageBtn(){this.nextBtn.enable()}disablePrevPageBtn(){this.prevBtn.disable()}enablePrevPageBtn(){this.prevBtn.enable()}}window.addEventListener("DOMContentLoaded",(()=>{alert("Привет. Прошу, не забудь включить/перезагрузить сервер перед проверкой. Спасибо!")}));const P=new e("div").setAttribute("id","root").attachTo(document.body),x=new class{routes;garageView;winnersView;model;container;activeView;constructor(t){this.model=new l,this.container=new e("main").setClass("flex flex-col xl:items-center min-h-screen px-2 text-slate-300 bg-slate-700").attachTo(t),this.renderHeader(),this.renderRoutingBtns(),this.garageView=new m(this.createCarCallback,this.selectCarCallback,this.updateCarCallback,this.deleteCarCallback,this.switchGaragePageCallback,this.generateCarsCallback,this.driveCarCallback,this.stopCarCallback,this.startRaceCallback,this.resetRaceCallback),this.winnersView=new T(this.getCarCallback,this.switchWinnersPageCallback,this.sortWinnersCallback),this.routes={garage:this.garageView,winners:this.winnersView},this.handleRouteChange(),window.onpopstate=()=>this.handleRouteChange()}handleRouteChange(){const e=window.location.hash.slice(1).toLowerCase(),t=e in this.routes?this.routes[e]:this.routes.garage;t!==this.activeView&&(this.activeView&&this.activeView.remove(),this.activeView=t,this.activeView.attachTo(this.container))}renderHeader(){new e("header").setClass("pt-3 text-5xl font-bold tracking-wide").setInnerText("Async Race").attachTo(this.container)}renderRoutingBtns(){const a=new e("div").setClass("flex gap-x-2 pt-4").attachTo(this.container);new t("garage","light").attachTo(a).setHandler("click",(()=>{window.location.href="#garage"})),new t("winners","light").attachTo(a).setHandler("click",(()=>{window.location.href="#winners"}))}renderGaragePage(){this.model.getCars().then((e=>{this.garageView.renderPage(e);const t=Number(e.count)>7*this.model.getCurrentGaragePage(),a=this.model.getCurrentGaragePage()>1;t?this.garageView.enableNextPageBtn():this.garageView.disableNextPageBtn(),a?this.garageView.enablePrevPageBtn():this.garageView.disablePrevPageBtn()}))}renderWinnersPage(){this.model.getWinners().then((e=>{this.winnersView.renderPage(e,this.model.getCurrentWinnersPage());const t=Number(e.count)>10*this.model.getCurrentWinnersPage(),a=this.model.getCurrentWinnersPage()>1;t?this.winnersView.enableNextPageBtn():this.winnersView.disableNextPageBtn(),a?this.winnersView.enablePrevPageBtn():this.winnersView.disablePrevPageBtn()}))}getCarCallback=e=>this.model.getCar(e);selectCarCallback=e=>{this.model.getCar(e).then((e=>this.garageView.openСarUpdate(e)))};updateCarCallback=(e,t)=>{this.model.updateCar(e,t).then((()=>this.renderGaragePage()))};createCarCallback=e=>{this.model.createCar(e).then((()=>this.renderGaragePage()))};deleteCarCallback=e=>{this.model.deleteCar(e).then((()=>{const t=this.garageView.carUpdateField.getOpenedCarId();t&&t===e&&this.garageView.carUpdateField.writingModeOff(),this.renderGaragePage()})),this.model.deleteWinner(e).then((e=>{e&&this.renderWinnersPage()}))};generateCarsCallback=(e=100)=>{const t=new Array(e).fill("").map((()=>{const e={name:`${a[s(a.length)]} ${n[s(n.length)]}`,color:`#${Math.floor(16777215*Math.random()).toString(16)}`};return this.model.createCar(e)}));Promise.all(t).then((()=>this.renderGaragePage()))};driveCarCallback=(e,t)=>this.model.startEngine(e).then((a=>{const n=a.distance/a.velocity;return this.garageView.doDriveCarAnimation(e,n),new Promise(((a,s)=>{this.model.switchEngine(e).then((r=>{r.success?a({name:t,id:e,duration:n}):(this.garageView.doBreakCarAnimation(e),s(new Error("Engine broke")))}))}))}));stopCarCallback=e=>{this.model.stopEngine(e).then((()=>this.garageView.doStopCarAnimation(e)))};startRaceCallback=()=>{const e=this.garageView.getCarTracksArray().map((e=>e.drive()));this.garageView.raceModeOn(),Promise.any(e).then((({id:e,name:t,duration:a})=>{const n=new Date(a),s=n.getUTCSeconds(),r=n.getUTCMilliseconds(),i=parseFloat(`${s}.${r}`);this.garageView.raceModeOff(),this.garageView.openWinMessage(t,i),this.model.saveWinner(e,{id:e,wins:1,time:i}).then((()=>this.renderWinnersPage()))})).catch((()=>{this.garageView.raceModeOff(),this.garageView.openWinMessage()}))};resetRaceCallback=()=>{this.garageView.getCarTracksArray().forEach((e=>e.stop()))};switchGaragePageCallback=e=>this.model.switchCurrentGaragePage(e).finally((()=>this.renderGaragePage()));switchWinnersPageCallback=e=>this.model.switchCurrentWinnersPage(e).finally((()=>this.renderWinnersPage()));sortWinnersCallback=e=>{this.model.setSortOrder(e),this.renderWinnersPage()};start(){this.renderGaragePage(),this.renderWinnersPage()}}(P);x.start()}();