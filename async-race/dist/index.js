!function(){"use strict";class e{constructor(e){this.element=document.createElement(e)}attachTo(t){return t instanceof e?t.element.append(this.element):t.append(this.element),this}setClass(e){const t=Array.isArray(e)?e:e.split(" ");return this.element.classList.add(...t),this}removeClass(e){const t=Array.isArray(e)?e:e.split(" ");return this.element.classList.remove(...t),this}setAttribute(e,t=""){return this.element.setAttribute(e,t),this}setInnerText(e){return this.element.innerText=e,this}setHandler(e,t,n){return this.element.addEventListener(e,t,n),this}setInnerHTML(e){return this.element.innerHTML=e,this}clearInnerHTML(){return this.element.innerHTML="",this}remove(){return this.element.remove(),this}animate(e,t){return this.element.animate(e,t)}}class t extends e{constructor(e,t){super("button"),this.setInnerText(e).setClass(["flex","justify-center","items-center","w-max","h-6","px-2","py-1","font-medium","text-gray-600","capitalize","border-2","border-transparent","rounded","transition-colors","cursor-pointer"]),"light"===t?this.setClass("bg-yellow-100 hover:border-indigo-400"):this.setClass("bg-indigo-200 hover:border-indigo-400"),this.status="enabled"}enable(){return this.removeClass("cursor-not-allowed opacity-50"),this.setClass("cursor-pointer hover:border-indigo-400 opacity-100"),this.status="enabled",this}disable(){return this.removeClass("cursor-pointer hover:border-indigo-400 opacity-100"),this.setClass("cursor-not-allowed opacity-50"),this.status="disabled",this}getStatus(){return this.status}}const n=["Acura","Alfa Romeo","Alpine","Apollo","Apple","Aston Martin","Audi","Automobili Pininfarina","Bentley","BMW","Bollinger","Brilliance","Bugatti","Buick","BYD","Cadillac","Chana","Chery","Chevrolet","Chrysler","Citroen","Continental","CUPRA","Dacia","Daewoo","Daihatsu","Datsun","Detroit Electric","Dodge","DS Automobiles","FAW","Ferrari","Fiat","Fisker","Ford","Foxtron","Geely","Genesis","GMC","Great Wall","Haval","Honda","Hummer","Hyundai","Ineos","Infiniti","Iran Khodro","JAC","Jaguar","Jeep","JETOUR","KIA","Koenigsegg","Lada","Lamborghini","Lancia","Land Rover","Lexus","Lifan","Lincoln","Lordstown","Lotus","Lucid","LvChi","Lynk & Co","Maserati","Maybach","Mazda","MCLaren","Mercedes-Benz","MG","MINI","Mitsubishi","Nikola","NIO","Nissan","Opel","Pagani","Peugeot","Polestar","Porsche","Qoros","Range Rover","Ravon","Renault","Rimac","Rivian","Rolls-Royce","Saab","Saipa","SEAT","Skoda","Smart","SangYong","SSC North America","Stellantis","Subaru","Suzuki","Tata","Tesla","Torsus","Toyota","VinFast","Volkswagen","Volvo","Xpeng","Zotye"],s=["Durango","Ram","Challenger","Charger","Grand Caravan","X7","X5","X3","X6 M","X6","X1","X4","C3 Aircross","C5 Aircross","Duster","CR-V","Corolla","IS 200t","LS 500h","RX","ES 200/250/350","Hatchback","CX-5","Sedan","CX-30","CX-9","CX-3","MX-5 Roadster","Phantom","Camry","Polo","Cullinan","Ghost","Dawn","Duster","Arkana","Sandero","Logan","Trafic Fourgon","Logan MCV","Captur","Kadjar","RAV4","Rio","Creta","Solaris"],r=e=>Math.floor(Math.random()*e);var i,a,o,h;!function(e){e.PREV="prev",e.NEXT="next"}(i||(i={})),function(e){e.WINS="wins",e.TIME="time"}(a||(a={})),function(e){e.DESC="DESC",e.ASC="ASC"}(o||(o={})),function(e){e.DEFAULT="default",e.ASC="ASC",e.DESC="DESC"}(h||(h={}));var l=function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function a(e){try{h(s.next(e))}catch(e){i(e)}}function o(e){try{h(s.throw(e))}catch(e){i(e)}}function h(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}h((s=s.apply(e,t||[])).next())}))};class c{constructor(){this.currentGaragePage=1,this.currentWinnersPage=1,this.basePath="http://127.0.0.1:3000",this.garagePath=`${this.basePath}/garage`,this.enginePath=`${this.basePath}/engine`,this.winnersPath=`${this.basePath}/winners`}getCars(){return l(this,void 0,void 0,(function*(){try{const e=yield fetch(`${this.garagePath}?_page=${this.currentGaragePage}&_limit=7`);if(!e.ok)throw new Error("Fetch request failed");const t=e.headers.get("X-Total-Count");if(!t)throw new Error("Header is not set");return{items:yield e.json(),count:t}}catch(e){throw console.error(e),new Error("getCars request failed")}}))}getCarsCount(){return l(this,void 0,void 0,(function*(){const e=yield this.getCars();return Number(e.count)}))}getWinnersCount(){return l(this,void 0,void 0,(function*(){const e=yield this.getWinners();return Number(e.count)}))}getCar(e){return l(this,void 0,void 0,(function*(){return(yield fetch(`${this.garagePath}/${e}`)).json()}))}createCar(e){return l(this,void 0,void 0,(function*(){try{const t=yield fetch(this.garagePath,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Fetch request failed");return yield t.json()}catch(e){throw console.error(e),new Error("createCar request failed")}}))}deleteCar(e){return l(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this.garagePath}/${e}`,{method:"DELETE"});if(!t.ok)throw new Error("Fetch request failed");return yield t.json()}catch(e){throw console.error(e),new Error("deleteCar request failed")}}))}updateCar(e,t){return l(this,void 0,void 0,(function*(){try{const n=yield fetch(`${this.garagePath}/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error("Fetch request failed");return yield n.json()}catch(e){throw console.error(e),new Error("updateCar request failed")}}))}startEngine(e){return l(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this.enginePath}?id=${e}&status=started`,{method:"PATCH"});if(!t.ok)throw new Error("Fetch request failed");return yield t.json()}catch(e){throw console.error(e),new Error("startEngine request failed")}}))}stopEngine(e){return l(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this.enginePath}?id=${e}&status=stopped`,{method:"PATCH"});if(!t.ok)throw new Error("Fetch request failed");return yield t.json()}catch(e){throw console.error(e),new Error("startEngine request failed")}}))}switchEngine(e){return l(this,void 0,void 0,(function*(){const t=yield fetch(`${this.enginePath}?id=${e}&status=drive`,{method:"PATCH"});return t.ok?Object.assign({},yield t.json()):{success:!1}}))}switchCurrentGaragePage(e){return l(this,void 0,void 0,(function*(){const t=yield this.getCarsCount(),n=Math.ceil(t/7);return e===i.NEXT&&(this.currentGaragePage=this.currentGaragePage===n?n:this.currentGaragePage+1),e===i.PREV&&(this.currentGaragePage=1===this.currentGaragePage?1:this.currentGaragePage-1),this.currentGaragePage}))}switchCurrentWinnersPage(e){return l(this,void 0,void 0,(function*(){const t=yield this.getWinnersCount(),n=Math.ceil(t/10);return e===i.NEXT&&(this.currentWinnersPage=this.currentWinnersPage===n?n:this.currentWinnersPage+1),e===i.PREV&&(this.currentWinnersPage=1===this.currentWinnersPage?1:this.currentWinnersPage-1),this.currentWinnersPage}))}getCurrentGaragePage(){return this.currentGaragePage}getCurrentWinnersPage(){return this.currentWinnersPage}getWinners(){return l(this,void 0,void 0,(function*(){try{let e;if(this.currentSortOrder){const[t,n]=this.currentSortOrder;e=yield fetch(`${this.winnersPath}?_page=${this.currentWinnersPage}&_limit=10&_sort=${t}&_order=${n}`)}else e=yield fetch(`${this.winnersPath}?_page=${this.currentWinnersPage}&_limit=10`);if(!e.ok)throw new Error("Fetch request failed");const t=e.headers.get("X-Total-Count");if(!t)throw new Error("Header is not set");return{items:yield e.json(),count:t}}catch(e){throw console.error(e),new Error("getCars request failed")}}))}getWinner(e){return l(this,void 0,void 0,(function*(){return(yield fetch(`${this.winnersPath}/${e}`)).json()}))}createWinner(e){return l(this,void 0,void 0,(function*(){return(yield fetch(this.winnersPath,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json()}))}updateWinner(e,t){return l(this,void 0,void 0,(function*(){return(yield fetch(`${this.winnersPath}/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})).json()}))}getWinnerHTTPStatus(e){return l(this,void 0,void 0,(function*(){return(yield fetch(`${this.winnersPath}/${e}`)).status}))}saveWinner(e,t){return l(this,void 0,void 0,(function*(){if(404===(yield this.getWinnerHTTPStatus(e)))this.createWinner(t);else{const{wins:n,time:s}=yield this.getWinner(e);this.updateWinner(e,{wins:n+1,time:t.time<s?t.time:s})}}))}deleteWinner(e){return l(this,void 0,void 0,(function*(){return 200===(yield this.getWinnerHTTPStatus(e))&&(yield fetch(`${this.winnersPath}/${e}`,{method:"DELETE"}),!0)}))}setSortOrder(e){this.currentSortOrder=e}}class d extends e{constructor(){super("input"),this.setAttribute("type","color").setClass("bg-slate-300 rounded cursor-pointer")}getColorInput(){if(this.element instanceof HTMLInputElement)return this.element.value;throw new Error("Element is not instance of HTMLInputElement")}setColorInput(e){if(!(this.element instanceof HTMLInputElement))throw new Error("Element is not instance of HTMLInputElement");this.element.value=e}}class g extends e{constructor(){super("input"),this.setAttribute("type","text").setAttribute("autocomplete","off").setClass("px-2 text-slate-700 font-semibold bg-slate-300 rounded outline-indigo-300 cursor-pointer")}getTextInput(){if(this.element instanceof HTMLInputElement)return this.element.value;throw new Error("Element is not instance of HTMLInputElement")}setTextInput(e){if(!(this.element instanceof HTMLInputElement))throw new Error("Element is not instance of HTMLInputElement");this.element.value=e}}class u extends e{constructor(e){super("div"),this.onUpdate=e,this.setClass("flex gap-x-4"),this.openedCarID=null,this.searchBar=(new g).attachTo(this),this.colorPicker=(new d).attachTo(this),this.btn=new t("update","dark").attachTo(this),this.writingModeOff()}open({name:e,color:t,id:n}){this.writingModeOn(),this.searchBar.setTextInput(e),this.colorPicker.setColorInput(t),this.openedCarID=n,this.btn.setHandler("click",(()=>{this.openedCarID&&(this.onUpdate(this.openedCarID,{name:this.searchBar.getTextInput(),color:this.colorPicker.getColorInput()}),this.writingModeOff())}),{once:!0})}close(){this.writingModeOff()}writingModeOn(){[this.searchBar,this.colorPicker].forEach((e=>e.removeClass("opacity-50 cursor-not-allowed").setClass("cursor-pointer"))),this.btn.enable()}writingModeOff(){[this.searchBar,this.colorPicker].forEach((e=>e.removeClass("cursor-pointer").setClass("opacity-50 cursor-not-allowed"))),this.btn.disable(),this.searchBar.setTextInput(""),this.colorPicker.setColorInput("#000000")}getOpenedCarId(){return this.openedCarID}}const C=[{left:"2%"},{left:"91%"}];class w extends e{constructor(n,s,r,i,a){super("div"),this.carData=n,this.onSelectCar=s,this.onDeleteCar=r,this.onDriveCar=i,this.onStopCar=a,this.setClass("flex flex-col gap-y-3"),this.carElement=new e("div"),this.driveBtn=new t("A","dark"),this.stopBtn=new t("B","dark"),this.selectBtn=new t("select","light"),this.removeBtn=new t("remove","light"),this.createTrackControls(this.carData.name,this.carData.id).attachTo(this),this.createCarTrack().attachTo(this.createEngineControls().attachTo(this))}createTrackControls(t,n){const s=new e("div").setClass("flex gap-x-2");return this.selectBtn.setHandler("click",(()=>{"disabled"!==this.selectBtn.getStatus()&&this.onSelectCar(n)})).attachTo(s),this.removeBtn.setHandler("click",(()=>{"disabled"!==this.removeBtn.getStatus()&&this.onDeleteCar(n)})).attachTo(s),new e("div").setClass("ml-2 font-semibold text-md").setInnerText(t).attachTo(s),s}createEngineControls(){const t=new e("div").setClass("flex items-center gap-x-2");return this.driveBtn.attachTo(t).removeClass("bg-indigo-200 w-max").setClass("w-6 h-6 bg-emerald-200 rounded-full").setHandler("click",(()=>{"disabled"!==this.driveBtn.getStatus()&&(this.driveModeOn(),this.onDriveCar(this.carData.id,this.carData.name))})),this.stopBtn.attachTo(t).removeClass("bg-indigo-200 w-max").setClass("w-6 h-6 bg-emerald-200 rounded-full").disable().setHandler("click",(()=>{"disabled"!==this.stopBtn.getStatus()&&(this.driveModeOff(),this.onStopCar(this.carData.id))})),t}createCarTrack(){const t=new e("div").setClass("relative flex-grow flex max-w-[90rem] h-8 ml-3 bg-slate-400 rounded");return this.carElement.setClass("w-8 h-8 absolute left-[2%]").setInnerHTML(` <svg class="w-full h-full rotate-90" style="fill: ${this.carData.color};">\n          <use xlink:href="#car-top-view"></use>\n        </svg>`).attachTo(t),new e("div").setClass("absolute right-[9%] w-8 h-8").setInnerHTML(' <svg class="w-full h-full stroke-indigo-100 fill-indigo-100 rotate-90">\n          <use xlink:href="#finish-line"></use>\n        </svg>').attachTo(t),t}doDriveAnimation(e){this.carAnimation&&this.carAnimation.cancel(),this.carAnimation=this.carElement.animate(C,(e=>({fill:"forwards",duration:e}))(e))}doBreakAnimation(){this.carAnimation&&this.carAnimation.pause()}doStopAnimation(){this.carAnimation&&this.carAnimation.cancel()}driveModeOn(){this.driveBtn.disable(),setTimeout((()=>{this.stopBtn.enable()}),1500),this.selectBtn.disable(),this.removeBtn.disable()}driveModeOff(){this.driveBtn.enable(),this.stopBtn.disable(),this.selectBtn.enable(),this.removeBtn.enable()}drive(){return this.driveModeOn(),this.onDriveCar(this.carData.id,this.carData.name)}stop(){this.driveModeOff(),this.onStopCar(this.carData.id)}}class p extends e{constructor(n,s,r,i,a){super("div"),this.onSwitchPage=n,this.onSelectCar=s,this.onDeleteCar=r,this.onDriveCar=i,this.onStopCar=a,this.carTracks=new Map,this.setClass("flex flex-col xl:w-5/6 gap-y-2 pt-8"),this.garageCounter=new e("p").setClass(["font-bold","text-2xl","capitalize"]).attachTo(this),this.pageCounter=new e("p").setClass(["font-semibold","text-lg","capitalize"]).setInnerText("Page #1"),this.prevBtn=new t("prev","dark"),this.nextBtn=new t("next","dark"),this.createPageControls().attachTo(this),this.pageElement=new e("div").setClass("flex-grow flex flex-col gap-y-6 pt-4 pb-6").attachTo(this)}createPageControls(){const t=new e("div").setClass("flex items-center gap-x-3");return this.pageCounter.attachTo(t),this.prevBtn.attachTo(t).disable().setHandler("click",(()=>{"disabled"!==this.prevBtn.getStatus()&&this.onSwitchPage(i.PREV).then((e=>this.setPageCounter(e)))})),this.nextBtn.attachTo(t).disable().setHandler("click",(()=>{"disabled"!==this.nextBtn.getStatus()&&this.onSwitchPage(i.NEXT).then((e=>this.setPageCounter(e)))})),t}renderPage({items:e,count:t}){this.pageElement.clearInnerHTML(),this.garageCounter.setInnerText(`Garage (${t})`),this.carTracks.clear(),e.forEach((e=>{const t=new w(e,this.onSelectCar,this.onDeleteCar,this.onDriveCar,this.onStopCar);this.carTracks.set(t.carData.id,t),t.attachTo(this.pageElement)}))}setPageCounter(e){this.pageCounter.setInnerText(`Page #${e}`)}disableNextBtn(){this.nextBtn.disable()}enableNextBtn(){this.nextBtn.enable()}disablePrevBtn(){this.prevBtn.disable()}enablePrevBtn(){this.prevBtn.enable()}getCarTracks(){return this.carTracks}}class m extends e{constructor(){super("div"),this.setClass(["hidden","fixed","inset-0","flex","justify-center","items-center","bg-slate-900/50","z-10","hover:cursor-pointer"]),this.setHandler("click",(e=>{const{target:t}=e;null!=t&&t===this.element&&this.hide()}));const n=new e("div").attachTo(this).setClass(["relative","flex","flex-col","items-center","gap-y-5","min-w-48","px-2","py-3","bg-gray-100","rounded-md","hover:cursor-default"]);this.textElement=new e("p").setClass("font-semibold text-3xl text-slate-600 text-center").attachTo(n),new t("Close","dark").attachTo(n).setHandler("click",(()=>this.hide()))}open(e,t){this.removeClass("hidden"),t&&e?this.textElement.setInnerText(`${e} wins! [${t}s]`):this.textElement.setInnerText("No one wins! All cars were broken.")}hide(){this.setClass("hidden")}}class f extends e{constructor(e,n,s,r,i,a,o,h,l,c){super("section"),this.onCreateCar=e,this.onSelectCar=n,this.onUpdateCar=s,this.onDeleteCar=r,this.onSwitchPage=i,this.onGenerateCars=a,this.onDriveCar=o,this.onStopCar=h,this.onStartRace=l,this.onResetRace=c,this.setClass("self-stretch flex flex-col xl:items-center xl:min-w-full"),this.carUpdateField=new u(this.onUpdateCar),this.raceBtn=new t("race","light"),this.resetBtn=new t("reset","light"),this.pagination=new p(this.onSwitchPage,this.onSelectCar,this.onDeleteCar,this.onDriveCar,this.onStopCar),this.winMessage=new m,this.renderGeneralSettings(),this.pagination.attachTo(this),this.winMessage.attachTo(this)}renderGeneralSettings(){const t=new e("div").setClass("flex flex-col gap-y-3 max-w-sm pt-8").attachTo(this);this.createCarCreateField().attachTo(t),this.carUpdateField.attachTo(t),this.createGeneralBtns().attachTo(t)}createCarCreateField(){const n=new e("div").setClass("flex gap-x-4"),s=(new g).attachTo(n),r=(new d).attachTo(n);return new t("create","dark").setHandler("click",(()=>this.onCreateCar({name:s.getTextInput(),color:r.getColorInput()}))).attachTo(n),n}createGeneralBtns(){const n=new e("div").setClass("flex gap-x-3");return this.raceBtn.attachTo(n).setHandler("click",(()=>{"disabled"!==this.raceBtn.getStatus()&&this.onStartRace()})),this.resetBtn.attachTo(n).disable().setHandler("click",(()=>{"disabled"!==this.resetBtn.getStatus()&&(this.onResetRace(),this.resetBtn.disable(),setTimeout((()=>this.raceBtn.enable()),2500))})),new t("generate cars","dark").setClass("col-start-4 col-span-2").attachTo(n).setHandler("click",(()=>this.onGenerateCars())),n}renderPage(e){this.pagination.renderPage(e)}"openСarUpdate"(e){this.carUpdateField.open(e)}disableNextPageBtn(){this.pagination.disableNextBtn()}enableNextPageBtn(){this.pagination.enableNextBtn()}disablePrevPageBtn(){this.pagination.disablePrevBtn()}enablePrevPageBtn(){this.pagination.enablePrevBtn()}doDriveCarAnimation(e,t){const n=this.pagination.getCarTracks().get(e);if(!n)throw new Error(`No car with this id: ${e}`);n.doDriveAnimation(t)}doBreakCarAnimation(e){const t=this.pagination.getCarTracks().get(e);if(!t)throw new Error(`No car with this id: ${e}`);t.doBreakAnimation()}doStopCarAnimation(e){const t=this.pagination.getCarTracks().get(e);if(!t)throw new Error(`No car with this id: ${e}`);t.doStopAnimation()}getCarTracksArray(){return[...this.pagination.getCarTracks()].map((([,e])=>e))}openWinMessage(e,t){return this.winMessage.open(e,t)}raceModeOn(){this.raceBtn.disable(),this.resetBtn.disable()}raceModeOff(){this.resetBtn.enable()}}class v extends e{constructor(e){super("th"),this.name=e,this.state=h.DEFAULT,this.setClass("cursor-pointer"),this.setDefault()}setDefault(){return this.setInnerText(this.name),this.state=h.DEFAULT,this}setAscending(){return this.setInnerText(`${this.name}↑`),this.state=h.ASC,this}setDescending(){return this.setInnerText(`${this.name}↓`),this.state=h.DESC,this}getCurrentState(){return this.state}}class T extends e{constructor(t,n){super("table"),this.onGetCar=t,this.onSort=n,this.winsSortHandler=()=>{const e=this.winsSortBtn.getCurrentState();e===h.DEFAULT?(this.winsSortBtn.setDescending(),this.timeSortBtn.setDefault(),this.onSort([a.WINS,o.DESC])):e===h.DESC?(this.winsSortBtn.setAscending(),this.onSort([a.WINS,o.ASC])):e===h.ASC&&(this.winsSortBtn.setDefault(),this.onSort())},this.timeSortHandler=()=>{const e=this.timeSortBtn.getCurrentState();e===h.DEFAULT?(this.timeSortBtn.setDescending(),this.winsSortBtn.setDefault(),this.onSort([a.TIME,o.DESC])):e===h.DESC?(this.timeSortBtn.setAscending(),this.onSort([a.TIME,o.ASC])):e===h.ASC&&(this.timeSortBtn.setDefault(),this.onSort())},this.setClass("cursor-default"),this.setAttribute("sortable"),this.head=new e("thead").attachTo(this),this.body=new e("tbody").attachTo(this),this.winsSortBtn=new v("Wins"),this.timeSortBtn=new v("Best time (seconds)"),this.renderHeaders()}renderHeaders(){const t=new e("tr").setClass("min-h-8 bg-blue-500 text-md text-white").attachTo(this.head);new e("th").setInnerText("Number").attachTo(t),new e("th").setInnerText("Car").attachTo(t),new e("th").setInnerText("Name").attachTo(t),this.winsSortBtn.attachTo(t).setHandler("click",this.winsSortHandler),this.timeSortBtn.attachTo(t).setHandler("click",this.timeSortHandler)}renderPage(t,n){this.body.clearInnerHTML(),t.forEach((({wins:t,time:s,id:r},i)=>{const a=new e("tr").setClass("text-center text-md font-medium").attachTo(this.body);this.onGetCar(r).then((({name:r,color:o})=>{new e("td").setInnerText(`${10*(n-1)+i+1}`).attachTo(a),new e("td").setInnerHTML(` <svg class="w-7 h-7 rotate-90" style="fill: ${o};">\n                <use xlink:href="#car-top-view"></use>\n              </svg>`).attachTo(a),new e("td").setInnerText(`${r}`).attachTo(a),new e("td").setInnerText(`${t}`).attachTo(a),new e("td").setInnerText(`${s}s`).attachTo(a)}))}))}}class b extends e{constructor(n,s,r){super("section"),this.onGetCar=n,this.onSwitchPage=s,this.onSortWinners=r,this.setClass("flex flex-col xl:w-5/6 gap-y-2 pt-8"),this.winnersCounter=new e("p").setClass(["font-bold","text-2xl","capitalize"]).setInnerText("Winners (4)").attachTo(this),this.pageCounter=new e("p").setClass(["font-semibold","text-lg","capitalize"]).setInnerText("Page #1"),this.prevBtn=new t("prev","dark"),this.nextBtn=new t("next","dark"),this.renderPageControls().attachTo(this),this.leaderboard=new T(this.onGetCar,this.onSortWinners).attachTo(this)}renderPageControls(){const t=new e("div").setClass("flex items-center gap-x-3");return this.pageCounter.attachTo(t),this.prevBtn.attachTo(t).disable().setHandler("click",(()=>{"disabled"!==this.prevBtn.getStatus()&&this.onSwitchPage(i.PREV).then((e=>this.setPageCounter(e)))})),this.nextBtn.attachTo(t).disable().setHandler("click",(()=>{"disabled"!==this.nextBtn.getStatus()&&this.onSwitchPage(i.NEXT).then((e=>this.setPageCounter(e)))})),t}renderPage({items:e,count:t},n){this.winnersCounter.setInnerText(`Winners (${t})`),this.leaderboard.renderPage(e,n)}setPageCounter(e){this.pageCounter.setInnerText(`Page #${e}`)}disableNextPageBtn(){this.nextBtn.disable()}enableNextPageBtn(){this.nextBtn.enable()}disablePrevPageBtn(){this.prevBtn.disable()}enablePrevPageBtn(){this.prevBtn.enable()}}window.addEventListener("DOMContentLoaded",(()=>{alert("Привет. Прошу, не забудь включить/перезагрузить сервер перед проверкой. Спасибо!")}));const P=new e("div").setAttribute("id","root").attachTo(document.body),x=new class{constructor(t){this.getCarCallback=e=>this.model.getCar(e),this.selectCarCallback=e=>{this.model.getCar(e).then((e=>this.garageView.openСarUpdate(e)))},this.updateCarCallback=(e,t)=>{this.model.updateCar(e,t).then((()=>this.renderGaragePage()))},this.createCarCallback=e=>{this.model.createCar(e).then((()=>this.renderGaragePage()))},this.deleteCarCallback=e=>{this.model.deleteCar(e).then((()=>{const t=this.garageView.carUpdateField.getOpenedCarId();t&&t===e&&this.garageView.carUpdateField.writingModeOff(),this.renderGaragePage()})),this.model.deleteWinner(e).then((e=>{e&&this.renderWinnersPage()}))},this.generateCarsCallback=(e=100)=>{const t=new Array(e).fill("").map((()=>{const e={name:`${n[r(n.length)]} ${s[r(s.length)]}`,color:`#${Math.floor(16777215*Math.random()).toString(16)}`};return this.model.createCar(e)}));Promise.all(t).then((()=>this.renderGaragePage()))},this.driveCarCallback=(e,t)=>this.model.startEngine(e).then((n=>{const s=n.distance/n.velocity;this.garageView.doDriveCarAnimation(e,s);const r=Date.now();return new Promise((n=>{this.model.switchEngine(e).then((i=>{if(i.success){const i=Date.now()-r;setTimeout((()=>n([!1,{name:t,id:e,duration:s}])),s-i)}else this.garageView.doBreakCarAnimation(e),n([!0,{name:t,id:e,duration:s}])}))}))})),this.stopCarCallback=e=>{this.model.stopEngine(e).then((()=>this.garageView.doStopCarAnimation(e)))},this.startRaceCallback=()=>{const e=this.garageView.getCarTracksArray().map((e=>e.drive()));this.garageView.raceModeOn(),Promise.all(e).then((e=>{const t=e.filter((([e])=>!e)).map((e=>e[1]));return 1===t.length?t[0]:t.length>1?t.reduce(((e,t)=>t.duration<e.duration?t:e)):void 0})).then((e=>{return t=this,n=void 0,r=function*(){if(!e)return void this.garageView.openWinMessage();const{id:t,name:n,duration:s}=e,r=new Date(s),i=r.getUTCSeconds(),a=r.getUTCMilliseconds(),o=parseFloat(`${i}.${a}`);this.garageView.raceModeOff(),this.garageView.openWinMessage(n,o),this.model.saveWinner(t,{id:t,wins:1,time:o}).then((()=>this.renderWinnersPage()))},new((s=void 0)||(s=Promise))((function(e,i){function a(e){try{h(r.next(e))}catch(e){i(e)}}function o(e){try{h(r.throw(e))}catch(e){i(e)}}function h(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(a,o)}h((r=r.apply(t,n||[])).next())}));var t,n,s,r}))},this.resetRaceCallback=()=>{this.garageView.getCarTracksArray().forEach((e=>e.stop()))},this.switchGaragePageCallback=e=>this.model.switchCurrentGaragePage(e).finally((()=>this.renderGaragePage())),this.switchWinnersPageCallback=e=>this.model.switchCurrentWinnersPage(e).finally((()=>this.renderWinnersPage())),this.sortWinnersCallback=e=>{this.model.setSortOrder(e),this.renderWinnersPage()},this.model=new c,this.container=new e("main").setClass("flex flex-col xl:items-center min-h-screen px-2 text-slate-300 bg-slate-700").attachTo(t),this.renderHeader(),this.renderRoutingBtns(),this.garageView=new f(this.createCarCallback,this.selectCarCallback,this.updateCarCallback,this.deleteCarCallback,this.switchGaragePageCallback,this.generateCarsCallback,this.driveCarCallback,this.stopCarCallback,this.startRaceCallback,this.resetRaceCallback),this.winnersView=new b(this.getCarCallback,this.switchWinnersPageCallback,this.sortWinnersCallback),this.routes={garage:this.garageView,winners:this.winnersView},this.handleRouteChange(),window.onpopstate=()=>this.handleRouteChange()}handleRouteChange(){const e=window.location.hash.slice(1).toLowerCase(),t=e in this.routes?this.routes[e]:this.routes.garage;t!==this.activeView&&(this.activeView&&this.activeView.remove(),this.activeView=t,this.activeView.attachTo(this.container))}renderHeader(){new e("header").setClass("pt-3 text-5xl font-bold tracking-wide").setInnerText("Async Race").attachTo(this.container)}renderRoutingBtns(){const n=new e("div").setClass("flex gap-x-2 pt-4").attachTo(this.container);new t("garage","light").attachTo(n).setHandler("click",(()=>{window.location.href="#garage"})),new t("winners","light").attachTo(n).setHandler("click",(()=>{window.location.href="#winners"}))}renderGaragePage(){this.model.getCars().then((e=>{this.garageView.renderPage(e);const t=Number(e.count)>7*this.model.getCurrentGaragePage(),n=this.model.getCurrentGaragePage()>1;t?this.garageView.enableNextPageBtn():this.garageView.disableNextPageBtn(),n?this.garageView.enablePrevPageBtn():this.garageView.disablePrevPageBtn()}))}renderWinnersPage(){this.model.getWinners().then((e=>{this.winnersView.renderPage(e,this.model.getCurrentWinnersPage());const t=Number(e.count)>10*this.model.getCurrentWinnersPage(),n=this.model.getCurrentWinnersPage()>1;t?this.winnersView.enableNextPageBtn():this.winnersView.disableNextPageBtn(),n?this.winnersView.enablePrevPageBtn():this.winnersView.disablePrevPageBtn()}))}start(){this.renderGaragePage(),this.renderWinnersPage()}}(P);x.start()}();